# Разработка программного модуля контроля фокусировки системы компьютерной микроскопии   при съемке серии кадров изображений клеток крови.

## Исходные данные:

1. Съемка серии кадров выполняется через объектив микроскопа 100х в фиксированной позиции предметного столика микроскопа (позиция по х, y, z выбирается таким образом, чтобы в поле зрения камеры находилась хотя бы одна клетка лейкоцитарного ряда, и перед началом съемки серии кадров выполняется фокусировка изображения).
2. В ходе проведения съемки серии кадров из-за вибраций микроскопа и произвольных смещений предметного столика (из-за остаточных механических напряжений в приводах перемещения столика) возможно смещение столика из позиции резкой фокусировки (по координате z) и смещение по координатам (х, у).
3. В результате съемки серии кадров формируется набор файлов с изображениями клеток крови. Для всех кадров поле зрения камеры неизменно (с точностью до смещений, описанных в п. 2). Число файлов в серии от 10 до 3000.

## Задачи:

1. Вывод на монитор **произвольного изображения из набора файлов с предоставлением возможности пользователю управлять** увеличением изображения на экране и позицией выводимого на экран фрагмента изображения в поле исходного кадра**.
В информационной строке должно отражаться:
    - **Имя файла**
    - **Увеличение выводимого на экран изображения** (сколько реальных пикселей изображения выводится в один пиксель экрана - может быть дробным числом меньше 1 - две значащих цифры после запятой)
    - Позиция фрагмента, выводимого на экран монитора, в полном кадре изображения (Х1, У1) :(Х2, У2).
2. Вывод на монитор изображения из файла, **следующего по порядку в серии кадров по отношению к представленному изображению на экране** , в режиме быстрой смены **(смена кадра по однократному нажатию клавиши) - обеспечение прокрутки всех кадров** (информационная строка, увеличение и окно вывода такие, как в п.1)
3. Вывод на монитор изображения из файла **, предыдущего по порядку в серии кадров по отношению к представленному изображению на экране** , в режиме быстрой смены (по нажатию клавиши) - обеспечение прокрутки всех кадров (увеличение и окно вывода такие, как в п.1).
4. Предоставление возможности **пользователю выбрать из набора файлов опорный кадр или назначить опорным кадром файл, отображаемый на экране** ,  и обеспечение индикации выбранного опорного **кадра (имя файла с префиксом опорный кадр: ** - в информационной строке постоянно**, при выводе опорного кадра на экран индикация цветом(зеленый) и надписью опорный кадр).
5. Обеспечить переключение в режим **вывода разности текущего выбранного изображения и опорного кадра** с параметрами вывода на экран, соответствующими установленным в п.1. (в режиме вывода разности также должны обеспечиваться режимы отображения, описанные в п.2 и п.3).
Для управления режимом отображения разности должен быть **обеспечена возможность пользователю задать коэффициент усиления разности (от 1 до 127),** при выводе на экран к разности добавляется постоянное значение 128 по всем компонентам RGB).

`int R = qRed(Base.pixelColor(i,j)) - qRed(Current.pixelColor(i,j)) * k + 128`

6. Резкость:
    - Рассчитать критерий резкости для каждого из файлов,
    - В серии кадров **найти самое резкое во фрагменте изображение**. Фрагмент задается пользователем в интерактивном режиме в соответствии с п.1.
    - В информационной строке постоянно выводить сообщение **резкий кадр: имя файла,** при выводе изображения, соответствующего резкому фрагменту, на экран выполняется **индикация цветом(синий) и надписью резкий кадр).**
7. **При выводе изображения выводить в информационной строке значение критерия резкости** для этого изображения (для фрагмента в соответствии с п.6)
8. Построить **график зависимости критерия резкости от номера кадра в серии**. Предусмотреть интерактивный просмотр точек на графике - управлять перемещением вертикальной линии и отображать соответствующее ей имя файла и значение критерия резкости.
9.**В интерактивном режиме задать порог допустимого отклонения критерия резкости от самого резкого изображения, показывая горизонтальной линией на графике уровень этого порога. **Выводить значение** количества файлов, попадающих в допустимое отклонение **по резкости и непопадающих** (в абсолютном и в процентном значении по отношению к количеству кадров в серии).**
10. По указанию **пользователя (нажатием на соответствующую кнопку)** для установленного порога допустимого отклонения резкости **все файлы, непопадающие в допустимое отклонение по резкости, перемещаются в папку «unsharp»** , создаваемую внутри папки с набором файлов для серии кадров.
11. Обеспечить откат действия по п.10 по перемещению файлов.